<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>My products</h1>

<h2>Add product</h2>

<input type="text" id="product-name" placeholder="Product name"><br>
<input type="text" id="product-sku" placeholder="SKU"><br>
<input type="text" id="product-model" placeholder="Model"><br>
<input type="text" id="product-model-2" placeholder="Model 2"><br>
<input type="text" id="product-model-3" placeholder="Model 3"><br>
<input type="text" id="product-model-4" placeholder="Model 4"><br>
<input type="text" id="product-model-5" placeholder="Model 5"><br>
<input type="number" id="product-barcode" placeholder="Barcode"><br>
<input type="text" id="product-quantity" placeholder="Quantity"><br>
<input type="number" id="product-sell-price" placeholder="Sell Price"><br>
<input type="number" id="product-buy-price" placeholder="Buy Price"><br>

<input type="text" id="box" placeholder="Box"><br>
<input type="text" id="bag" placeholder="Bag"><br>
<textarea name="additional_info" id="additional_info" cols="30" rows="10" placeholder="Additional info"></textarea>


<select id="warehouse">
    <option value="">-- Select Warehouse --</option>
</select>

<select id="shelf">
    <option value="">-- Select Shelf --</option>
</select>

<select id="product-vendor" multiple>
    <option value="">-- Select Vendor --</option>
</select>

<select id="product-manufacturer">
    <option value="">-- Select Manufacturer --</option>
</select>

<select id="product-category">
    <option value="">-- Select Category --</option>
</select>

<button onclick="addProduct()">Add product</button>

<ul id="products-list"></ul>
{% csrf_token %}
<script>
    const csrftoken = '{{ csrf_token }}';
    const API_URL = 'http://127.0.0.1:8000/api/products/';

    async function loadSelectOptions(apiUrl, selectId) {
        const response = await fetch(apiUrl);
        const items = await response.json();
        const select = document.getElementById(selectId);

        items.forEach(item => {
            const option = document.createElement('option');
            option.value = item.id;
            option.textContent = item.name;
            select.appendChild(option);
        });
    }

    loadSelectOptions('http://127.0.0.1:8000/api/warehouses/', 'warehouse');
    loadSelectOptions('http://127.0.0.1:8000/api/shelfs/', 'shelf');
    loadSelectOptions('http://127.0.0.1:8000/api/vendors/', 'product-vendor');
    loadSelectOptions('http://127.0.0.1:8000/api/manufacturers/', 'product-manufacturer');
    loadSelectOptions('http://127.0.0.1:8000/api/categories/', 'product-category');


    async function addProduct() {
        const name = document.getElementById('product-name').value;
        const sku = document.getElementById('product-sku').value;
        const model = document.getElementById('product-model').value;
        const model_2 = document.getElementById('product-model-2').value;
        const model_3 = document.getElementById('product-model-3').value;
        const model_4 = document.getElementById('product-model-4').value;
        const model_5 = document.getElementById('product-model-5').value;
        const barcodeValue = document.getElementById('product-barcode').value.trim();
        const barcode = barcodeValue === '' ? null : barcodeValue
        const quantityValue = document.getElementById('product-quantity').value;
        const quantity = quantityValue === '' ? null : quantityValue
        const sell_price = document.getElementById('product-sell-price').value;
        const buy_price = document.getElementById('product-buy-price').value;

        const warehouse = document.getElementById('warehouse').value || null;
        const shelf = document.getElementById('shelf').value || null;
        const vendor = getSelectedValues('product-vendor');
        const manufacturer = document.getElementById('product-manufacturer').value || null;
        const category = document.getElementById('product-category').value || null;

        const productData = {
            name,
            sku,
            model,
            model_2,
            model_3,
            model_4,
            model_5,
            barcode,
            quantity,
            sell_price,
            buy_price,
            warehouse,
            shelf,
            vendor,
            manufacturer,
            category,
        };

        const response = await fetch(API_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrftoken
            },
            body: JSON.stringify(productData)
        });

        if (response.ok) {
            alert('Product added!');
            loadProducts();
        } else {
            const error = await response.json();
            alert('Error: ' + JSON.stringify(error));
        }
    }

    async function loadProducts() {
        const response = await fetch(API_URL);
        const products = await response.json();
        const list = document.getElementById('products-list');
        list.innerHTML = '';

        products.forEach(product => {
            const li = document.createElement('li');
            li.textContent = `${product.name} (SKU: ${product.sku}) - $${product.sell_price}`;
            list.appendChild(li);
        });
    }

    loadProducts();

    function getSelectedValues(selectId) {
        const selected = [];
        const options = document.getElementById(selectId).selectedOptions;
        for (let option of options) {
            selected.push(option.value);
        }
        return selected;
    }

</script>
</body>
</html>
